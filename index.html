<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Streaming App mit M3U-Playlist</title>
    <!-- Bootstrap CSS für einfaches Layout -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
        crossorigin="anonymous">
    <!-- Eigene CSS-Anpassungen -->
    <style>
        /* Stil für die Sidebar und den Player */
        .sidebar {
            background-color: #f8f9fa;
            padding: 15px;
            max-height: 100vh; /* Maximale Höhe auf die Höhe des Viewports setzen */
            overflow-y: auto; /* Vertikalen Scrollbalken hinzufügen, wenn nötig */
        }

        #videoPlayer {
            width: 100%;
            height: auto;
        }

        .tv-logo {
            width: 100px;
        }

        .channel:hover {
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.2); /* Subtilen Leuchteffekt bei Hover hinzufügen */
            transition: box-shadow 0.3s ease-in-out; /* Übergang für den Leuchteffekt definieren */
            cursor: pointer; /* Mauszeiger zu Zeiger ändern */
        }
    </style>
</head>

<body>
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-3">
                <div class="sidebar" id="playlist">
                    <!-- Hier werden die Playlist-Einträge dynamisch hinzugefügt -->
                </div>
            </div>
            <div class="col-md-9">
                <video id="videoPlayer" controls autoplay muted></video>
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/shaka-player/4.3.0/shaka-player.compiled.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const videoPlayer = document.getElementById("videoPlayer");
            const playlistContainer = document.getElementById("playlist");

            // M3U-URL zur Liste der Sender
            const m3uURL = 'https://raw.githubusercontent.com/gambler65/kongresi1908/e02c87c13cca9a31a602ca16f92c996c4021df8f/satlok.m3u';

            // Array zum Speichern der Playlist-Einträge
            let playlistItems = [];

            // M3U-Playlist laden und verarbeiten
            fetch(m3uURL)
                .then(response => response.text())
                .then(data => {
                    // Zeilenumbrüche entfernen und die Playlist in Blöcke aufteilen
                    data = data.trim();
                    const blocks = data.split('#EXTINF:-1');

                    for (let i = 1; i < blocks.length; i++) {
                        const block = blocks[i].trim();
                        const lines = block.split('\n');

                        if (lines.length > 1) {
                            const tvgName = lines[0].split(',')[1].trim();
                            const tvgLogo = lines[0].split('"')[3];
                            const channelUrl = lines[1].trim();

                            playlistItems.push({ tvgName, tvgLogo, channelUrl });

                            const playlistItem = document.createElement("div");
                            playlistItem.className = "channel d-flex flex-column p-3";
                            playlistItem.innerHTML = `<span>${tvgName}</span>`;
                            
                            if (tvgLogo) {
                                const logoImage = document.createElement("img");
                                logoImage.src = tvgLogo;
                                logoImage.className = "tv-logo";
                                playlistItem.appendChild(logoImage);
                            }

                            playlistItem.addEventListener("click", () => {
                                // Shaka Player verwenden, um den Kanal abzuspielen
                                if (window.player) {
                                    window.player.destroy();
                                }

                                window.player = new shaka.Player(videoPlayer);
                                window.player.load(channelUrl).then(function() {
                                    console.log("Kanal geladen");
                                }).catch(function(error) {
                                    console.error("Fehler beim Laden des Kanals", error);
                                });

                                // Zum Video-Player scrollen
                                videoPlayer.scrollIntoView({ behavior: 'smooth' });
                            });

                            playlistContainer.appendChild(playlistItem);
                        }
                    }
                })
                .catch(error => {
                    console.error('Fehler beim Laden der M3U-Playlist:', error);
                });
        });
    </script>
</body>

</html>
